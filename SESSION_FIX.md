# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (F5) —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –∑–∞–Ω–æ–≤–æ –≤–≤–æ–¥–∏—Ç—å –º–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å, —Ö–æ—Ç—è —Å–µ—Å—Å–∏—è –±—ã–ª–∞ –∞–∫—Ç–∏–≤–Ω–∞.

## –ü—Ä–∏—á–∏–Ω–∞

JavaScript –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –§—É–Ω–∫—Ü–∏—è `checkInitialization()` –ø—Ä–æ–≤–µ—Ä—è–ª–∞ —Ç–æ–ª—å–∫–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ë–î, –Ω–æ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## –†–µ—à–µ–Ω–∏–µ

### 1. Backend (app.py)

**–ò–∑–º–µ–Ω–µ–Ω–æ**: Endpoint `/api/init` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

```python
@app.route('/api/init', methods=['GET'])
def check_init():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—è –∏ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Å—Å–∏–∏"""
    db_session = db.get_session()
    master = db_session.query(MasterPassword).first()
    db_session.close()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏
    is_authenticated = session.get('authenticated', False)
    
    return jsonify({
        'initialized': master is not None,
        'authenticated': is_authenticated  # ‚Üê –ù–û–í–û–ï
    })
```

### 2. Frontend (app.js)

**–ò–∑–º–µ–Ω–µ–Ω–æ**: –§—É–Ω–∫—Ü–∏—è `checkInitialization()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

```javascript
async function checkInitialization() {
    try {
        const result = await apiCall('/init');
        
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
        if (result.authenticated) {  // ‚Üê –ù–û–í–û–ï
            showScreen('main-screen');
            await loadEntries();
        } else if (result.initialized) {
            showScreen('login-screen');
        } else {
            showScreen('init-screen');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
        showScreen('init-screen');
    }
}
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. `/api/init` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ initialized: true, authenticated: false }`
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞
4. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ `session['authenticated'] = True`

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (F5)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç F5
2. `/api/init` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ initialized: true, authenticated: true }`
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
4. –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏
5. **–ü–∞—Ä–æ–ª—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è!** ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ (10 –º–∏–Ω—É—Ç)
1. –ü—Ä–æ—à–ª–æ 10 –º–∏–Ω—É—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
2. Flask –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç —Å–µ—Å—Å–∏—é
3. `/api/init` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ initialized: true, authenticated: false }`
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
```
1. –í–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ù–∞–∂–º–∏—Ç–µ F5 (–æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É)
3. ‚úÖ –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –ë–ï–ó –∑–∞–ø—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
```

### –¢–µ—Å—Ç 2: –ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞
```
1. –í–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É —Å —Ç–µ–º –∂–µ URL
3. ‚úÖ –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –ë–ï–ó –∑–∞–ø—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
```

### –¢–µ—Å—Ç 3: –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
```
1. –í–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 10 –º–∏–Ω—É—Ç
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
4. ‚úÖ –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ (—Å–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞)
```

### –¢–µ—Å—Ç 4: –í—ã—Ö–æ–¥
```
1. –í–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ù–∞–∂–º–∏—Ç–µ "–í—ã—Ö–æ–¥"
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
4. ‚úÖ –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è —Å–µ—Å—Å–∏–∏

–í `app.py`:
```python
app.config['PERMANENT_SESSION_LIFETIME'] = timedelta(minutes=10)  # –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω–æ–µ
```

–ü—Ä–∏–º–µ—Ä—ã:
- `timedelta(minutes=5)` ‚Äî 5 –º–∏–Ω—É—Ç
- `timedelta(minutes=15)` ‚Äî 15 –º–∏–Ω—É—Ç
- `timedelta(hours=1)` ‚Äî 1 —á–∞—Å

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚úÖ –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- –°—Ç–∞—Ç—É—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (`authenticated`)
- –ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (`encryption_key`)
- –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (`last_activity`)

### ‚ùå –ß—Ç–æ –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- –ú–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å (–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è!)
- –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π

### üîí –ó–∞—â–∏—Ç–∞
- HttpOnly cookies (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)
- Secure cookies (—Ç–æ–ª—å–∫–æ HTTPS)
- SameSite=Strict (–∑–∞—â–∏—Ç–∞ –æ—Ç CSRF)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Ç–µ—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|-----------|
| `app.py` | +2 —Å—Ç—Ä–æ–∫–∏ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏) |
| `app.js` | +5 —Å—Ç—Ä–æ–∫ (–∞–≤—Ç–æ–≤—Ö–æ–¥ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏) |

## –°—Ç–∞—Ç—É—Å

‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** ‚Äî —Å–µ—Å—Å–∏—è —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã!
