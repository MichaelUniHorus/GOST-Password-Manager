#!/bin/bash

echo "========================================"
echo "  Менеджер паролей ГОСТ"
echo "========================================"
echo ""

# Проверка виртуального окружения
if [ ! -d "venv" ]; then
    echo "[1/3] Создание виртуального окружения..."
    python3 -m venv venv
    if [ $? -ne 0 ]; then
        echo "Ошибка: Не удалось создать виртуальное окружение"
        echo "Убедитесь, что Python 3.9+ установлен"
        exit 1
    fi
fi

# Активация виртуального окружения
echo "[2/3] Активация виртуального окружения..."
source venv/bin/activate

# Установка зависимостей
echo "[3/3] Проверка зависимостей..."
pip install -q -r requirements.txt
if [ $? -ne 0 ]; then
    echo "Ошибка: Не удалось установить зависимости"
    exit 1
fi

# Проверка .env файла
if [ ! -f ".env" ]; then
    echo ""
    echo "ВНИМАНИЕ: Файл .env не найден!"
    echo "Создаю из .env.example..."
    cp .env.example .env
    echo ""
    echo "Пожалуйста, отредактируйте .env файл перед использованием!"
    echo ""
fi

echo ""
echo "========================================"
echo "  Запуск приложения..."
echo "========================================"
echo ""
echo "Приложение будет доступно по адресу:"
echo "https://127.0.0.1:5000"
echo ""
echo "Нажмите Ctrl+C для остановки"
echo "========================================"
echo ""

# Запуск приложения
python app.py
